import{a,r as e,E as s,y as t,o as r,k as l,l as i,t as n,n as c,z as o,A as d,v as u,G as m,m as p,q as v,w as f,b as y,B as b,e as h,p as g}from"./vendor-vue-IgQ0LSVQ.js";import{c as k,a as x}from"./index.esm-DozezXMt.js";import{c as j}from"./crudService-DJEaAHbi.js";import{u as w}from"./notificationStore-Dw0I-Rqg.js";import{_}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-N31TBcPX.js";const A={class:"container py-4",style:{"max-width":"600px"}},O={class:"mb-3"},E={key:0,class:"invalid-feedback"},I={class:"mb-3"},V={class:"mb-3"},S={class:"form-check"},U={key:0,class:"alert alert-danger"},q={class:"d-flex gap-2"},B=["disabled"],z={key:0,class:"spinner-border spinner-border-sm me-2"},F=_(a({__name:"FormView",setup(a){const _=g(),F=s(),G=w(),N=j("/category"),C=e(!1),D=e(null),H=e(!!F.params.id),J=t({name:"",displayOrder:0,isActive:!0}),K=t({}),L=k({name:x().required("類別名稱為必填")});async function M(){D.value=null;if(await async function(){try{return await L.validate(J,{abortEarly:!1}),Object.keys(K).forEach(a=>delete K[a]),!0}catch(a){if(Object.keys(K).forEach(a=>delete K[a]),a.inner)for(const e of a.inner)e.path&&(K[e.path]=e.message);return!1}}()){C.value=!0;try{if(H.value&&J.categoryId){const a=await N.update(J.categoryId,J);if(!a||!a.data||!a.data.data)return void G.error("更新失敗：未授權或伺服器回應不正確");G.success("類別已更新")}else{const a=await N.create(J);if(!a||!a.data||!a.data.data)return void G.error("新增失敗：未授權或伺服器回應不正確");G.success("類別已新增")}_.push("/app/category")}catch(a){D.value=(null==a?void 0:a.message)||"操作失敗"}finally{C.value=!1}}}return r(async()=>{if(H.value&&F.params.id)try{const{data:a}=await N.getById(Number(F.params.id));Object.assign(J,a.data)}catch(a){D.value=(null==a?void 0:a.message)||"加載失敗"}}),(a,e)=>{const s=y("router-link");return h(),l("div",A,[i("h2",null,n(H.value?"編輯類別":"新增類別"),1),i("form",{onSubmit:b(M,["prevent"]),novalidate:""},[i("div",O,[e[3]||(e[3]=i("label",{class:"form-label"},"類別名稱",-1)),o(i("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>J.name=a),type:"text",class:u(["form-control",{"is-invalid":K.name}])},null,2),[[d,J.name]]),K.name?(h(),l("div",E,n(K.name),1)):c("",!0)]),i("div",I,[e[4]||(e[4]=i("label",{class:"form-label"},"排序",-1)),o(i("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>J.displayOrder=a),type:"number",class:"form-control"},null,512),[[d,J.displayOrder,void 0,{number:!0}]])]),i("div",V,[i("div",S,[o(i("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>J.isActive=a),type:"checkbox",class:"form-check-input",id:"isActive"},null,512),[[m,J.isActive]]),e[5]||(e[5]=i("label",{class:"form-check-label",for:"isActive"},"啟用",-1))])]),D.value?(h(),l("div",U,n(D.value),1)):c("",!0),i("div",q,[i("button",{class:"btn btn-primary",disabled:C.value},[C.value?(h(),l("span",z)):c("",!0),v(" "+n(H.value?"更新":"新增"),1)],8,B),p(s,{to:"/app/category",class:"btn btn-secondary"},{default:f(()=>[...e[6]||(e[6]=[v("返回",-1)])]),_:1})])],32)])}}}),[["__scopeId","data-v-232c8c32"]]);export{F as default};
