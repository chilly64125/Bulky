import{a as e,r as a,E as s,y as l,o as t,k as n,l as o,t as i,n as r,z as c,D as d,v as u,F as m,s as p,A as v,m as b,q as f,w as y,b as h,B as g,e as k,p as x}from"./vendor-vue-IgQ0LSVQ.js";import{c as j,d as w,a as _}from"./index.esm-nxtYy_By.js";import{a as V}from"./ancestralService-CNE58cwZ.js";import{u as I}from"./notificationStore-Dw0I-Rqg.js";import{_ as U}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-rv2ZoWvM.js";const S={class:"container py-4",style:{"max-width":"600px"}},q={class:"mb-3"},E=["value"],N={key:0,class:"invalid-feedback"},O={class:"mb-3"},R={key:0,class:"invalid-feedback"},B={class:"mb-3"},D={key:0,class:"invalid-feedback"},F={class:"mb-3"},P={class:"mb-3"},z={class:"mb-3"},A={key:0,class:"alert alert-danger"},T={class:"d-flex gap-2"},C=["disabled"],G={key:0,class:"spinner-border spinner-border-sm me-2"},H=U(e({__name:"FormView",setup(e){const U=x(),H=s(),J=I(),K=a(!1),L=a(null),M=a(!!H.params.id),Q=l({ancestralPositionId:0,positionId:"",side:"",section:"",level:0,position:0,occupantName:"",phone:"",dateRegistered:(new Date).toISOString().split("T")[0]}),W=l({}),X=a(["甲區","乙區","丙區","丁區","中區"]),Y=j({section:_().required("區域為必填"),level:w().required("層級為必填").min(1).max(10),position:w().required("位置為必填").min(1).max(10)});async function Z(){L.value=null;if(await async function(){try{return await Y.validate(Q,{abortEarly:!1}),Object.keys(W).forEach(e=>delete W[e]),!0}catch(e){if(Object.keys(W).forEach(e=>delete W[e]),e.inner&&e.inner.length)for(const a of e.inner)a.path&&a.message&&(W[a.path]=a.message);return!1}}()){K.value=!0;try{M.value?(await V.update(Q.ancestralPositionId,Q),J.success("牌位已更新")):(await V.create(Q),J.success("牌位已新增")),U.push("/ancestral")}catch(e){L.value=(null==e?void 0:e.message)||"操作失敗"}finally{K.value=!1}}}return t(async()=>{if(M.value)try{const{data:e}=await V.getById(Number(H.params.id)),a=e.data;Object.assign(Q,a)}catch(e){L.value=(null==e?void 0:e.message)||"加載失敗"}}),(e,a)=>{const s=h("router-link");return k(),n("div",S,[o("h2",null,i(M.value?"編輯牌位":"新增牌位"),1),o("form",{onSubmit:g(Z,["prevent"]),novalidate:""},[o("div",q,[a[7]||(a[7]=o("label",{class:"form-label"},"區域",-1)),c(o("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>Q.section=e),class:u(["form-control",{"is-invalid":W.section}])},[a[6]||(a[6]=o("option",{value:""},"選擇區域",-1)),(k(!0),n(m,null,p(X.value,e=>(k(),n("option",{key:e,value:e},i(e),9,E))),128))],2),[[d,Q.section]]),W.section?(k(),n("div",N,i(W.section),1)):r("",!0)]),o("div",O,[a[8]||(a[8]=o("label",{class:"form-label"},"層級",-1)),c(o("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>Q.level=e),type:"number",class:u(["form-control",{"is-invalid":W.level}])},null,2),[[v,Q.level,void 0,{number:!0}]]),W.level?(k(),n("div",R,i(W.level),1)):r("",!0)]),o("div",B,[a[9]||(a[9]=o("label",{class:"form-label"},"位置",-1)),c(o("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>Q.position=e),type:"number",class:u(["form-control",{"is-invalid":W.position}])},null,2),[[v,Q.position,void 0,{number:!0}]]),W.position?(k(),n("div",D,i(W.position),1)):r("",!0)]),o("div",F,[a[10]||(a[10]=o("label",{class:"form-label"},"佔用者名稱",-1)),c(o("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>Q.occupantName=e),type:"text",class:"form-control"},null,512),[[v,Q.occupantName]])]),o("div",P,[a[11]||(a[11]=o("label",{class:"form-label"},"電話",-1)),c(o("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>Q.phone=e),type:"tel",class:"form-control"},null,512),[[v,Q.phone]])]),o("div",z,[a[12]||(a[12]=o("label",{class:"form-label"},"登記日期",-1)),c(o("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>Q.dateRegistered=e),type:"date",class:"form-control"},null,512),[[v,Q.dateRegistered]])]),L.value?(k(),n("div",A,i(L.value),1)):r("",!0),o("div",T,[o("button",{class:"btn btn-primary",disabled:K.value},[K.value?(k(),n("span",G)):r("",!0),f(" "+i(M.value?"更新":"新增"),1)],8,C),b(s,{to:"/app/ancestral",class:"btn btn-secondary"},{default:y(()=>[...a[13]||(a[13]=[f("返回",-1)])]),_:1})])],32)])}}}),[["__scopeId","data-v-93a22e3b"]]);export{H as default};
