import{a as e,r as a,E as s,y as l,o as t,k as r,l as o,t as i,n,z as c,A as m,v as u,G as d,m as p,q as f,w as v,b,B as y,e as h,p as k}from"./vendor-vue-IgQ0LSVQ.js";import{c as x,a as j}from"./index.esm-nxtYy_By.js";import{c as g}from"./crudService-BHQG69IU.js";import{u as w}from"./notificationStore-Dw0I-Rqg.js";import{_}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-rv2ZoWvM.js";const V={class:"container py-4",style:{"max-width":"600px"}},N={class:"mb-3"},U=["disabled"],E={key:0,class:"invalid-feedback"},I={class:"mb-3"},R={key:0,class:"invalid-feedback"},q={class:"mb-3"},A={class:"mb-3"},O={class:"mb-3"},S={class:"form-check"},B={class:"form-check"},C={key:0,class:"alert alert-danger"},z={class:"d-flex gap-2"},F=["disabled"],G={key:0,class:"spinner-border spinner-border-sm me-2"},D=_(e({__name:"FormView",setup(e){const _=k(),D=s(),H=w(),J=g("/user"),K=a(!1),L=a(null),M=a(!!D.params.id),P=l({username:"",email:"",firstName:"",lastName:"",roles:[]}),Q=l({}),T=x({username:j().required("用戶名為必填"),email:j().email("請輸入有效的電郵").required("電郵為必填")});async function W(){L.value=null;if(await async function(){try{return await T.validate(P,{abortEarly:!1}),Object.keys(Q).forEach(e=>delete Q[e]),!0}catch(e){if(Object.keys(Q).forEach(e=>delete Q[e]),e.inner)for(const a of e.inner)a.path&&(Q[a.path]=a.message);return!1}}()){K.value=!0;try{M.value&&P.userId?(await J.update(P.userId,P),H.success("會員已更新")):(await J.create(P),H.success("會員已新增")),_.push("/app/user")}catch(e){L.value=(null==e?void 0:e.message)||"操作失敗"}finally{K.value=!1}}}return t(async()=>{if(M.value&&D.params.id)try{const{data:e}=await J.getById(D.params.id);Object.assign(P,e.data)}catch(e){L.value=(null==e?void 0:e.message)||"加載失敗"}}),(e,a)=>{const s=b("router-link");return h(),r("div",V,[o("h2",null,i(M.value?"編輯會員":"新增會員"),1),o("form",{onSubmit:y(W,["prevent"]),novalidate:""},[o("div",N,[a[6]||(a[6]=o("label",{class:"form-label"},"用戶名",-1)),c(o("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>P.username=e),type:"text",autocomplete:"username",class:u(["form-control",{"is-invalid":Q.username}]),disabled:M.value},null,10,U),[[m,P.username]]),Q.username?(h(),r("div",E,i(Q.username),1)):n("",!0)]),o("div",I,[a[7]||(a[7]=o("label",{class:"form-label"},"電郵",-1)),c(o("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>P.email=e),type:"email",autocomplete:"email",class:u(["form-control",{"is-invalid":Q.email}])},null,2),[[m,P.email]]),Q.email?(h(),r("div",R,i(Q.email),1)):n("",!0)]),o("div",q,[a[8]||(a[8]=o("label",{class:"form-label"},"名字",-1)),c(o("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>P.firstName=e),type:"text",class:"form-control"},null,512),[[m,P.firstName]])]),o("div",A,[a[9]||(a[9]=o("label",{class:"form-label"},"姓氏",-1)),c(o("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>P.lastName=e),type:"text",class:"form-control"},null,512),[[m,P.lastName]])]),o("div",O,[a[12]||(a[12]=o("label",{class:"form-label"},"角色",-1)),o("div",S,[c(o("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>P.roles=e),type:"checkbox",value:"Admin",class:"form-check-input",id:"adminRole"},null,512),[[d,P.roles]]),a[10]||(a[10]=o("label",{class:"form-check-label",for:"adminRole"},"Admin",-1))]),o("div",B,[c(o("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>P.roles=e),type:"checkbox",value:"Customer",class:"form-check-input",id:"customerRole"},null,512),[[d,P.roles]]),a[11]||(a[11]=o("label",{class:"form-check-label",for:"customerRole"},"Customer",-1))])]),L.value?(h(),r("div",C,i(L.value),1)):n("",!0),o("div",z,[o("button",{class:"btn btn-primary",disabled:K.value},[K.value?(h(),r("span",G)):n("",!0),f(" "+i(M.value?"更新":"新增"),1)],8,F),p(s,{to:"/app/user",class:"btn btn-secondary"},{default:v(()=>[...a[13]||(a[13]=[f("返回",-1)])]),_:1})])],32)])}}}),[["__scopeId","data-v-c0575abf"]]);export{D as default};
