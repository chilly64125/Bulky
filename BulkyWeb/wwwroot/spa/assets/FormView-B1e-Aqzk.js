import{a,r as e,E as s,y as l,o as t,k as r,l as i,t as o,n as c,z as n,A as d,v as u,m as p,q as m,w as v,b,B as f,e as y,p as g}from"./vendor-vue-IgQ0LSVQ.js";import{c as I,d as k,a as h}from"./index.esm-nxtYy_By.js";import{c as x}from"./crudService-BHQG69IU.js";import{u as j}from"./notificationStore-Dw0I-Rqg.js";import{_ as w}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-rv2ZoWvM.js";const U={class:"container py-4",style:{"max-width":"600px"}},_={class:"mb-3"},V={key:0,class:"invalid-feedback"},q={class:"mb-3"},E={class:"mb-3"},O={key:0,class:"invalid-feedback"},S={class:"mb-3"},B={key:0,class:"invalid-feedback"},D={class:"mb-3"},z={key:0,class:"alert alert-danger"},A={class:"d-flex gap-2"},F=["disabled"],L={key:0,class:"spinner-border spinner-border-sm me-2"},N=w(a({__name:"FormView",setup(a){const w=g(),N=s(),R=j(),C=x("/product"),G=e(!1),H=e(null),J=e(!!N.params.id),K=l({title:"",description:"",categoryId:0,price:0,imageUrl:""}),M=l({}),P=I({title:h().required("標題為必填"),categoryId:k().required("類別ID為必填"),price:k().required("價格為必填").positive()});async function Q(){H.value=null;if(await async function(){try{return await P.validate(K,{abortEarly:!1}),Object.keys(M).forEach(a=>delete M[a]),!0}catch(a){if(Object.keys(M).forEach(a=>delete M[a]),a.inner)for(const e of a.inner)e.path&&(M[e.path]=e.message);return!1}}()){G.value=!0;try{J.value&&K.productId?(await C.update(K.productId,K),R.success("活動已更新")):(await C.create(K),R.success("活動已新增")),w.push("/app/product")}catch(a){H.value=(null==a?void 0:a.message)||"操作失敗"}finally{G.value=!1}}}return t(async()=>{if(J.value&&N.params.id)try{const{data:a}=await C.getById(Number(N.params.id));Object.assign(K,a.data)}catch(a){H.value=(null==a?void 0:a.message)||"加載失敗"}}),(a,e)=>{const s=b("router-link");return y(),r("div",U,[i("h2",null,o(J.value?"編輯活動":"新增活動"),1),i("form",{onSubmit:f(Q,["prevent"]),novalidate:""},[i("div",_,[e[5]||(e[5]=i("label",{class:"form-label"},"標題",-1)),n(i("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>K.title=a),type:"text",class:u(["form-control",{"is-invalid":M.title}])},null,2),[[d,K.title]]),M.title?(y(),r("div",V,o(M.title),1)):c("",!0)]),i("div",q,[e[6]||(e[6]=i("label",{class:"form-label"},"描述",-1)),n(i("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>K.description=a),class:"form-control",rows:"3"},null,512),[[d,K.description]])]),i("div",E,[e[7]||(e[7]=i("label",{class:"form-label"},"類別ID",-1)),n(i("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>K.categoryId=a),type:"number",class:u(["form-control",{"is-invalid":M.categoryId}])},null,2),[[d,K.categoryId,void 0,{number:!0}]]),M.categoryId?(y(),r("div",O,o(M.categoryId),1)):c("",!0)]),i("div",S,[e[8]||(e[8]=i("label",{class:"form-label"},"價格",-1)),n(i("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>K.price=a),type:"number",step:"0.01",class:u(["form-control",{"is-invalid":M.price}])},null,2),[[d,K.price,void 0,{number:!0}]]),M.price?(y(),r("div",B,o(M.price),1)):c("",!0)]),i("div",D,[e[9]||(e[9]=i("label",{class:"form-label"},"圖片URL",-1)),n(i("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>K.imageUrl=a),type:"url",class:"form-control"},null,512),[[d,K.imageUrl]])]),H.value?(y(),r("div",z,o(H.value),1)):c("",!0),i("div",A,[i("button",{class:"btn btn-primary",disabled:G.value},[G.value?(y(),r("span",L)):c("",!0),m(" "+o(J.value?"更新":"新增"),1)],8,F),p(s,{to:"/app/product",class:"btn btn-secondary"},{default:v(()=>[...e[10]||(e[10]=[m("返回",-1)])]),_:1})])],32)])}}}),[["__scopeId","data-v-2f2c157e"]]);export{N as default};
