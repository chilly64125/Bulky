import{a as e,r as s,y as a,f as l,k as n,l as i,n as t,z as r,A as o,v as u,t as d,m as c,w as m,b as p,q as v,B as b,p as f,e as _}from"./vendor-vue-IgQ0LSVQ.js";import{c as E,a as R}from"./index.esm-DJpjL8N3.js";import{u as w}from"./index-C6TQgNXw.js";import{_ as N}from"./_plugin-vue_export-helper-BCo6x5W8.js";const O={class:"container py-4",style:{"max-width":"420px"}},A={class:"mb-3"},y={key:0,class:"invalid-feedback"},D={class:"mb-3"},I={key:0,class:"invalid-feedback"},C={class:"d-flex justify-content-between align-items-center mb-3"},h=["disabled"],L={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},T={key:0,class:"alert alert-danger alert-dismissible fade show d-flex align-items-start",role:"alert"},g={class:"flex-grow-1"},S={class:"mb-0 mt-1"},k=["innerHTML"],x=N(e({__name:"LoginView",setup(e){const N=f(),x=w(),U=s(!1),V=s(null),M=s(null),j=a({email:"",password:""}),F=a({}),K=E({email:R().email("請輸入有效的電子郵件").required("電子郵件為必填"),password:R().min(6,"密碼至少6位").required("密碼為必填")}),W=l(()=>{switch(M.value){case"INVALID_CREDENTIALS":return"請檢查您的電子郵件和密碼是否正確。";case"USER_NOT_FOUND":return"此電子郵件尚未註冊。請 <a href='/register'>建立新帳號</a>。";case"INVALID_PASSWORD":return"密碼錯誤。請稍後重試，或 <a href='#'>重設密碼</a>。";case"ACCOUNT_LOCKED":return"帳號已被鎖定，請稍後再試或聯絡客服。";case"ACCOUNT_DISABLED":return"此帳號已被停用。請聯絡客服以取得協助。";case"EMAIL_NOT_CONFIRMED":return"您需要先驗證電子郵件。請檢查您的收件箱中的驗證信件。";case"NETWORK_ERROR":return"網路連線失敗。請檢查您的網路連線並重試。";case"SERVER_ERROR":return"伺服器出現問題。請稍後再試。";default:return"如果問題持續發生，請聯絡客服尋求協助。"}});async function q(){V.value=null,M.value=null;if(await async function(){try{return await K.validate(j,{abortEarly:!1}),F.email=void 0,F.password=void 0,!0}catch(e){if(F.email=void 0,F.password=void 0,e.inner&&e.inner.length)for(const s of e.inner)s.path&&s.message&&(F[s.path]=s.message);return!1}}()){U.value=!0;try{await x.login({username:j.email,password:j.password}),x.isAdmin?N.push("/app/admin"):(x.isCustomer,N.push("/app/customer"))}catch(e){const s=(null==e?void 0:e.message)||"登入失敗，請稍後再試";V.value=s,M.value=function(e){const s=e.toLowerCase();return s.includes("invalid")&&s.includes("credential")?"INVALID_CREDENTIALS":s.includes("user")&&s.includes("not")&&s.includes("found")?"USER_NOT_FOUND":s.includes("password")&&s.includes("incorrect")?"INVALID_PASSWORD":s.includes("locked")?"ACCOUNT_LOCKED":s.includes("disabled")?"ACCOUNT_DISABLED":s.includes("email")&&s.includes("confirm")?"EMAIL_NOT_CONFIRMED":s.includes("network")||s.includes("timeout")?"NETWORK_ERROR":s.includes("server")?"SERVER_ERROR":"INVALID_CREDENTIALS"}(s)}finally{U.value=!1}}}function B(){x.initializeAuth(),N.push("/")}return(e,s)=>{const a=p("router-link");return _(),n("div",O,[s[9]||(s[9]=i("h2",{class:"mb-3"},"登入",-1)),i("form",{onSubmit:b(q,["prevent"]),novalidate:""},[i("div",A,[s[2]||(s[2]=i("label",{class:"form-label"},"電子郵件",-1)),r(i("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>j.email=e),type:"email",autocomplete:"username",class:u(["form-control",{"is-invalid":F.email}])},null,2),[[o,j.email]]),F.email?(_(),n("div",y,d(F.email),1)):t("",!0)]),i("div",D,[s[3]||(s[3]=i("label",{class:"form-label"},"密碼",-1)),r(i("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>j.password=e),type:"password",autocomplete:"current-password",class:u(["form-control",{"is-invalid":F.password}])},null,2),[[o,j.password]]),F.password?(_(),n("div",I,d(F.password),1)):t("",!0)]),i("div",C,[c(a,{to:"/register"},{default:m(()=>[...s[4]||(s[4]=[v("註冊帳號",-1)])]),_:1}),i("button",{class:"btn btn-primary",disabled:U.value},[U.value?(_(),n("span",L)):t("",!0),s[5]||(s[5]=v(" 登入 ",-1))],8,h)]),i("div",{class:"text-center mb-3"},[i("button",{type:"button",class:"btn btn-outline-secondary",onClick:B},"訪客登入")]),V.value?(_(),n("div",T,[s[7]||(s[7]=i("i",{class:"bi bi-exclamation-circle me-2 flex-shrink-0 mt-1"},null,-1)),i("div",g,[s[6]||(s[6]=i("strong",null,"登入失敗",-1)),i("p",S,d(V.value),1),i("small",{class:"text-muted d-block mt-2",innerHTML:W.value},null,8,k)]),s[8]||(s[8]=i("button",{type:"button",class:"btn-close","data-bs-dismiss":"alert","aria-label":"Close"},null,-1))])):t("",!0)],32)])}}}),[["__scopeId","data-v-0631a843"]]);export{x as default};
