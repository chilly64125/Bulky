import{a as e,r as a,E as s,y as l,o,k as n,l as t,t as i,n as r,z as c,D as d,v as u,F as m,s as v,A as p,m as f,q as b,w as y,b as k,B as w,e as g,p as h}from"./vendor-vue-IgQ0LSVQ.js";import{c as j,d as x,a as _}from"./index.esm-DJpjL8N3.js";import{k as V}from"./kindnessService-B1VP09PC.js";import{u as I}from"./notificationStore-Dw0I-Rqg.js";import{_ as U}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-C6TQgNXw.js";const q={class:"container py-4",style:{"max-width":"600px"}},S={class:"mb-3"},E=["value"],N={key:0,class:"invalid-feedback"},O={class:"mb-3"},R=["value"],B={key:0,class:"invalid-feedback"},D={class:"mb-3"},F={key:0,class:"invalid-feedback"},P={class:"mb-3"},z={key:0,class:"invalid-feedback"},A={class:"mb-3"},T={class:"mb-3"},C={key:0,class:"alert alert-danger"},G={class:"d-flex gap-2"},H=["disabled"],J={key:0,class:"spinner-border spinner-border-sm me-2"},K=U(e({__name:"FormView",setup(e){const U=h(),K=s(),L=I(),M=a(!1),Q=a(null),W=a(!!K.params.id),X=l({kindnessPositionId:0,positionId:"",floor:1,section:"",row:0,column:0,occupantName:"",dateRegistered:(new Date).toISOString().split("T")[0]}),Y=l({}),Z=a([1,2,3]),$=a(["甲區","乙區","丙區","丁區","戊區","己區"]),ee=j({floor:x().required("樓層為必填"),section:_().required("區域為必填"),row:x().required("列為必填").min(1),column:x().required("欄為必填").min(1)});async function ae(){Q.value=null;if(await async function(){try{return await ee.validate(X,{abortEarly:!1}),Object.keys(Y).forEach(e=>delete Y[e]),!0}catch(e){if(Object.keys(Y).forEach(e=>delete Y[e]),e.inner&&e.inner.length)for(const a of e.inner)a.path&&a.message&&(Y[a.path]=a.message);return!1}}()){M.value=!0;try{W.value?(await V.update(X.kindnessPositionId,X),L.success("塔位已更新")):(await V.create(X),L.success("塔位已新增")),U.push("/kindness")}catch(e){Q.value=(null==e?void 0:e.message)||"操作失敗"}finally{M.value=!1}}}return o(async()=>{if(W.value)try{const{data:e}=await V.getById(Number(K.params.id)),a=e.data;Object.assign(X,a)}catch(e){Q.value=(null==e?void 0:e.message)||"加載失敗"}}),(e,a)=>{const s=k("router-link");return g(),n("div",q,[t("h2",null,i(W.value?"編輯塔位":"新增塔位"),1),t("form",{onSubmit:w(ae,["prevent"]),novalidate:""},[t("div",S,[a[7]||(a[7]=t("label",{class:"form-label"},"樓層",-1)),c(t("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>X.floor=e),class:u(["form-control",{"is-invalid":Y.floor}])},[a[6]||(a[6]=t("option",{value:""},"選擇樓層",-1)),(g(!0),n(m,null,v(Z.value,e=>(g(),n("option",{key:e,value:e},i(e)+"樓",9,E))),128))],2),[[d,X.floor,void 0,{number:!0}]]),Y.floor?(g(),n("div",N,i(Y.floor),1)):r("",!0)]),t("div",O,[a[9]||(a[9]=t("label",{class:"form-label"},"區域",-1)),c(t("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>X.section=e),class:u(["form-control",{"is-invalid":Y.section}])},[a[8]||(a[8]=t("option",{value:""},"選擇區域",-1)),(g(!0),n(m,null,v($.value,e=>(g(),n("option",{key:e,value:e},i(e),9,R))),128))],2),[[d,X.section]]),Y.section?(g(),n("div",B,i(Y.section),1)):r("",!0)]),t("div",D,[a[10]||(a[10]=t("label",{class:"form-label"},"列",-1)),c(t("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>X.row=e),type:"number",class:u(["form-control",{"is-invalid":Y.row}])},null,2),[[p,X.row,void 0,{number:!0}]]),Y.row?(g(),n("div",F,i(Y.row),1)):r("",!0)]),t("div",P,[a[11]||(a[11]=t("label",{class:"form-label"},"欄",-1)),c(t("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>X.column=e),type:"number",class:u(["form-control",{"is-invalid":Y.column}])},null,2),[[p,X.column,void 0,{number:!0}]]),Y.column?(g(),n("div",z,i(Y.column),1)):r("",!0)]),t("div",A,[a[12]||(a[12]=t("label",{class:"form-label"},"佔用者名稱",-1)),c(t("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>X.occupantName=e),type:"text",class:"form-control"},null,512),[[p,X.occupantName]])]),t("div",T,[a[13]||(a[13]=t("label",{class:"form-label"},"登記日期",-1)),c(t("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>X.dateRegistered=e),type:"date",class:"form-control"},null,512),[[p,X.dateRegistered]])]),Q.value?(g(),n("div",C,i(Q.value),1)):r("",!0),t("div",G,[t("button",{class:"btn btn-primary",disabled:M.value},[M.value?(g(),n("span",J)):r("",!0),b(" "+i(W.value?"更新":"新增"),1)],8,H),f(s,{to:"/app/kindness",class:"btn btn-secondary"},{default:y(()=>[...a[14]||(a[14]=[b("返回",-1)])]),_:1})])],32)])}}}),[["__scopeId","data-v-fe82f3c4"]]);export{K as default};
